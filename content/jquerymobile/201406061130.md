Status: draft
Title: jquerymobile jqplotのタブ表示
Date: 2014-06-06 11:30
Category: jquerymobile
Tags: jquerymobile, jqplot, tips
Slug: jquerymobilejqplottabs
Author: youske
Summary: jquerymobile jqplotのタブ表示について調べてみた。

# はじめに
jquerymobileとjqplotを利用してグラフを描画することができる。
タブを利用してタブの切り替えにて異なるグラフを描画しようと思っていたところうまく行かない。

うまく行かない原因の一つとして
タブが描画される前に描画jqplotのオブジェクト描画が終了していることに起因する。

そこで考えたのが
jqplotのオブジェクトを再描画できれば良いのでは？

ありました。
replot()

このコマンドで再描画をかけることができる。

あともう一つ
タブの切り替えを検知する方法

なかなか調べても見つからない。
jquerymobileで利用しているtab関連のシステムは前のjQueryUIとほぼお同じとのこと
そこでjQueryUIのドキュメントを漁ることに

tabの切り替えの検知ができれば良いので
tabsactivateなるものを発見

これ自体はタブのページが切り替わるタイミング（つまりクリックされたどこかのタブがアクティベートされる）ので、これを利用する。


ポイントは２つ
タブの切り替えを検知して何番目のタブがアクティベートされたかを知る。
何番目に割り当てられているjqplotのオブジェクトを割り出し、replotする。

どうやらこれでタブ切り替えで別のグラフを表示できそうだ。


とにかくはじめはタブが切り替われば該当のjqplotオブジェクトの再描画を行うようにコードを記述
つまりこんな感じ

    $("#graphtabs").on('tabsactivate', function(event,ui) {
       console.log( ui );
       jqplotObject.replot();
    });

この場合どこのタブが押されようとも問答無用でjqplotの再描画がかかる。
試してみると成功
タブを切り替えると切り替わった先のタブで描画が行われている。


このままでは不完全なので次のような目標を設定

*　すでに再描画がされているjqplotオブジェクトは描画をしない。
* タブとと描画したいjqplotオブジェクトを区分けしたい。


対象となっているjqplotオブジェクトが描画されたかどうかを判断する場合

jqplotObject.drawCount 
にてすでに描画されているかを検知できそうだ




押されたタブがどこか？　検出するには次のようにする。

    $("#graphtabs").on('tabsactivate', function(event,ui) {
       var selindex = ui.newTab.index();
       if ( selindex == 1 && jqplotObject.drawCount===0){
         jqplotObject.replot();
       } 
    });

タブは一番左を先頭 0として右方向に+1づつされる。
ゆえにタブの枚数-1が選択されたタブの位置ということになる。


uiのデータを調べる。
今回新しく選択されたタブと直前に選択されたタブnewTab oldTab
がセットされている。

当然のことながらnewTabを参照して描画の区分けを行う。








この投稿はversion1.4.2とします。(いくつか変わっている点があるため)

* 使い勝手
* 幾つか調べたところ
* パフォーマンス
* 現状だと何に使えるか？

